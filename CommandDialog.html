<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
    }
    
    .input-section {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #666;
      font-weight: 500;
    }
    
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .quick-commands {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 20px;
    }
    
    .quick-btn {
      padding: 10px;
      background: #f5f5f5;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      text-align: center;
      transition: all 0.2s;
    }
    
    .quick-btn:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .response {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      display: none;
    }
    
    .response.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      display: block;
    }
    
    .response.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
      display: block;
    }
    
    .response h3 {
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .response pre {
      background: rgba(0,0,0,0.05);
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 10px;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #667eea;
    }
    
    .loading.active {
      display: block;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .examples {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 12px;
      color: #666;
    }
    
    .examples h4 {
      margin-bottom: 8px;
      color: #333;
    }
    
    .examples ul {
      list-style: none;
      padding-left: 0;
    }
    
    .examples li {
      padding: 4px 0;
    }
    
    .examples li:before {
      content: "‚Ä¢ ";
      color: #667eea;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ AI Agent Command Interface</h1>
    
    <div class="input-section">
      <label for="commandInput">Enter your command:</label>
      <input 
        type="text" 
        id="commandInput" 
        placeholder="e.g., sync orders, show revenue, orders summary"
        onkeypress="if(event.key==='Enter') executeCommand()"
      >
    </div>
    
    <div class="quick-commands">
      <div class="quick-btn" onclick="setCommand('sync orders')">Sync Orders</div>
      <div class="quick-btn" onclick="setCommand('show revenue')">Show Revenue</div>
      <div class="quick-btn" onclick="setCommand('orders summary')">Orders Summary</div>
      <div class="quick-btn" onclick="setCommand('profit breakdown')">Profit Breakdown</div>
      <div class="quick-btn" onclick="setCommand('product sales')">Product Sales</div>
      <div class="quick-btn" onclick="setCommand('backup PSL')">Backup PSL</div>
      <div class="quick-btn" onclick="setCommand('reset arcus ui apply')">Reset UI</div>
      <div class="quick-btn" onclick="setCommand('what is each tab for?')">Tab Info</div>
    </div>
    
    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
      <button id="executeBtn" onclick="executeCommand()" style="flex: 1;">Execute Command</button>
      <button onclick="pingApi()" style="flex: 0 0 auto; padding: 12px 20px; background: #28a745; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px;">üîç Ping</button>
    </div>
    
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>Processing your command...</div>
    </div>
    
    <div class="response" id="response">
      <h3 id="responseTitle"></h3>
      <div id="responseMessage"></div>
      <pre id="responseData"></pre>
    </div>
    
    <div class="examples">
      <h4>Example Commands:</h4>
      <ul>
        <li>"sync orders" - Sync orders from Shopify</li>
        <li>"show revenue" - Get total revenue</li>
        <li>"orders summary" - Get orders summary</li>
        <li>"profit breakdown" - Get profit analysis</li>
        <li>"product sales" - Get product sales</li>
        <li>"backup PSL" - Backup PSL values</li>
        <li>"restore PSL" - Restore PSL values</li>
      </ul>
    </div>
  </div>
  
  <script>
    function setCommand(command) {
      document.getElementById('commandInput').value = command;
      executeCommand();
    }
    
    function executeCommand() {
      var command = document.getElementById('commandInput').value.trim();
      
      if (!command) {
        alert('Please enter a command');
        return;
      }
      
      var loading = document.getElementById('loading');
      var response = document.getElementById('response');
      var executeBtn = document.getElementById('executeBtn');
      var responseTitle = document.getElementById('responseTitle');
      var responseMessage = document.getElementById('responseMessage');
      var responseData = document.getElementById('responseData');
      
      // Show loading
      loading.classList.add('active');
      response.style.display = 'none';
      executeBtn.disabled = true;
      
      // Execute command using Google Apps Script
      google.script.run
        .withSuccessHandler(function(result) {
          loading.classList.remove('active');
          executeBtn.disabled = false;
          
          console.log('Result received:', JSON.stringify(result, null, 2));
          
          // Handle response - check multiple possible formats
          var isSuccess = false;
          var message = '';
          var data = null;
          
          if (result.success) {
            // Apps Script wrapper succeeded
            if (result.data) {
              // Check if data has success field
              if (result.data.success !== undefined) {
                isSuccess = result.data.success;
                message = result.data.message || 'Command executed';
                data = result.data.data;
              } else {
                // Data is the response itself
                isSuccess = true;
                message = result.data.message || 'Command executed successfully';
                data = result.data.data || result.data;
              }
            } else {
              isSuccess = true;
              message = 'Command executed successfully';
            }
          } else {
            // Apps Script wrapper failed
            isSuccess = false;
            message = result.message || result.error || 'Command failed';
            data = result;
          }
          
          if (isSuccess) {
            response.className = 'response success';
            responseTitle.textContent = '‚úì Success';
            responseMessage.textContent = message;
            
            if (data) {
              responseData.textContent = JSON.stringify(data, null, 2);
              responseData.style.display = 'block';
            } else {
              responseData.style.display = 'none';
            }
            
            response.style.display = 'block';
          } else {
            response.className = 'response error';
            responseTitle.textContent = '‚úó Error';
            responseMessage.textContent = message;
            responseData.textContent = JSON.stringify(result, null, 2);
            responseData.style.display = 'block';
            response.style.display = 'block';
          }
        })
        .withFailureHandler(function(error) {
          loading.classList.remove('active');
          executeBtn.disabled = false;
          
          console.error('Error:', error);
          
          response.className = 'response error';
          responseTitle.textContent = '‚úó Error';
          responseMessage.textContent = 'Failed to execute command: ' + (error.message || error.toString());
          responseData.textContent = JSON.stringify(error, null, 2);
          responseData.style.display = 'block';
          response.style.display = 'block';
        })
        .executeCommand(command);
    }
    
    function pingApi() {
      var loading = document.getElementById('loading');
      var response = document.getElementById('response');
      var responseTitle = document.getElementById('responseTitle');
      var responseMessage = document.getElementById('responseMessage');
      var responseData = document.getElementById('responseData');
      
      loading.classList.add('active');
      response.style.display = 'none';
      
      google.script.run
        .withSuccessHandler(function(result) {
          loading.classList.remove('active');
          
          console.log('Ping result:', JSON.stringify(result, null, 2));
          
          response.className = result.success ? 'response success' : 'response error';
          responseTitle.textContent = result.success ? '‚úì Ping Success' : '‚úó Ping Failed';
          responseMessage.textContent = result.success 
            ? 'API is responding correctly!' 
            : (result.message || result.error || 'API connection failed');
          responseData.textContent = JSON.stringify(result, null, 2);
          responseData.style.display = 'block';
          response.style.display = 'block';
        })
        .withFailureHandler(function(error) {
          loading.classList.remove('active');
          
          response.className = 'response error';
          responseTitle.textContent = '‚úó Ping Error';
          responseMessage.textContent = 'Error: ' + (error.message || error.toString());
          responseData.textContent = JSON.stringify(error, null, 2);
          responseData.style.display = 'block';
          response.style.display = 'block';
        })
        .pingApi();
    }
  </script>
</body>
</html>
